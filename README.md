# Урок 6: Интеграция с ChatGPT

В прошлых практических заданиях мы написали весьма неплохой веб-сервис для работы с проектами, который хранит
данные в PostgreSQL базе данных и имеет удобный веб-интерфейс. Было бы глупо не попытаться прикрутить к нему GPT, 
чем сегодня и займемся. :)

## Задание:

1. Для работы с GPT мы будем использовать библиотеку openai, перейди в Pipfile и на строке 12 добавь ее в список 
зависимостей внутри блока [packages]. 
```
openai = "*"
```

2. Поскольку ключ ты уже сгенерировал, давай сразу присвоим его переменной.
Открой [project_service.py](app/services/project_service.py), на строке 10 присвой полученный ключ переменной API_KEY.
```
= "sk-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"
```

3. А теперь укажи модель GPT, которую мы будем использовать, на строке 12.
```
= "gpt-3.5-turbo"
```

4. Готово! Теперь перейди на строку 95 и изучи метод ask_gpt, который отправляет запрос к GPT и возвращает ответ, а затем 
сохраняет сообщения в историю переписки с помощью метода append_chat_history.

5. Перейди в [project_router.py](app/routers/project_router.py) и изучи метод ask_gpt. 
Он добавлен специально, чтобы запросы к ChatGPT можно было совершать через веб-интерфейс. 

6. Также посмотри код в [project.py](app/models/project.py), там добавлено поле messages, которое хранит историю переписки в базе данных.
Специально для этого был создан класс Chat_message, который находится в [chat_message.py](app/models/chat_message.py).

7. Запусти Docker, останови и удали старый контейнер, также удали volume, затем создай новый контейнер с помощью docker-compose,
запусти приложение и перейди по адресу http://localhost:8080/. Ты должен увидеть главную страницу сайта.

8. Зайди на сайт, создай проект, перейди в него и задай вопросы ChatGPT, попробуй также отредактировать и удалить проект. 

9. Обязательно просмотри весь код проекта, мы специально оставили комментарии, которые помогут тебе разобраться в нем. 

Отлично, твой сервис полностью функционален! По итогам 7-и уроков у тебя получилось написать 
полноценный веб-сервис на FastAPI для работы с проектами, который интегрирован с GPT и может хранить историю переписки.

### Важные примечания:

1. Для того чтобы корректно начать работу зайди в настройки 
(File-->Settings-->Project-->ProjectStructure) и пометь директорию app в качестве Sources. 
Это нужно, чтобы программа могла правильно видеть файлы внутри проекта.
2. Перед запуском проекта не забудь установить все зависимости из Pipfile.lock.
3. Пиши свой код только внутри отведенных областей между комментариями, 
каждая область помечена номером, соответствующим номеру задания и содержит обозначения границ ("начало" и "конец").
4. Пользуйся поисковыми системами и сервисом Chat GPT, чтобы быстрее находить решения.


###### В директории examples ты можешь найти решения заданий, но мы рекомендуем попытаться решить их самостоятельно.